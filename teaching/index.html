
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Projects Browser</title>
	<link rel="icon" type="image/x-icon" href="../lib/favicon.ico">
	<link rel="stylesheet" type="text/css" href="../lib/style.css">
    <script src="../lib/d3.min.js"></script>

	<style type="text/css">

		span.components,
		span.dependencies {
	    	border-radius: 5px;
	    	margin: 3px;
		    padding: 2px;
		    display: inline-block;
	    	font-size: .9em;
	    }

		span.components{
			border: 2px solid #BDC0C7;
		}

		span.dependencies {
			border: 2px solid #B73939;
		}

	    div#imageContainer {
	    	margin: auto;
	    	display: block;
	    	border: 3px solid #000000;
	    	border-radius: 10px;
	    	padding: 10px;
	    }

	    div#slideshow{
	    	margin: 0 auto;
	    	text-align: center;
	    }

	    button{
	    	cursor: pointer;
	    }

	    .files{
	    	cursor: pointer;
	    }

	    .files:hover {
    		color: #aaa;
		}

	    .filename{
	    	font-size: 13px;
    		padding-left: 2px;
    		padding-right: 6px;
	    	text-decoration: underline;
	    }

		#viewer{
	    	margin-top: .5em;
		}

	    object#viewer{
	    	width: 960px;
	    	height: 720px;
	    }

    </style>
</head>

<body>
	<header>
		<!-- Course name and drop downs -->	
		<div id = "selectors">		
			PennDesign | Building Performance Simulation | Fall 2015
			<select id = "student-name"></select>
		</div>
	</header>
	<div id = "info">
		<!-- Student name / Assignment topic -->
		<h1 id="student-name"></h1>
		<h2 id="project-name">Pick One of the students</h2>
	</div>
	<div id = "grid">
		<!-- image grid -->
	</div> 
	<div id = "downloads">
		<!-- list of available files to download -->
	</div>
	<div id = "viewer">
		<!-- pdf viewer -->
	</div> 
	<footer>
		Created by <a href="https://github.com/mostaphaRoudsari" target="blank">Mostapha Sadeghipor Roudsari</a>
		<a href="https://twitter.com/__mostapha__" target="blank" style="float:right"> @__Mostapha__</a>
	</footer>
</body>

<script type="text/javascript">
	
	// this should be part of uri
	var school = "upenn",
		course = "arch753",
		semester = "fall15";

	var students,
		assignments,
		baseLocation = "../data/teaching/"+ school + "/" + course + "/" + semester,
		courseInfo = baseLocation + "/courseInfo.json";
	
	var background = "../lib/images/gradient_background.png"
	var background1 = "../lib/images/gradient_background_1.png"
	courseInfo = "https://dl.dropboxusercontent.com/u/16228160/D3TestData/courseInfo.json";
	
	// load courseInfo.json	
	d3.json(courseInfo, function(error, data){
		students = data.students;
		assignments = data.assignments;

		// add selector for students
		var studentSelect = d3.select("select#student-name");
			
		studentSelect.selectAll("option")
              .data(students)
              .enter()
                .append("option")
                .attr("value", function(d){ return d.id; })
                .text(function(d){ return d.name + " " + d.familyname; });
		
		studentSelect.append("option")
            .text("Students...")
			.attr("selected", "selected")
			.attr("disabled", "disabled");
		
		studentSelect.on("change", load_assignments);

		// create grid
		var studentsGrid = d3.select("#grid").selectAll(".grid")
          	.data(students)
        	.enter().insert("a", "br")
          		.attr("class", "grid")
          		.attr("title", function(d) {return d.name + " " + d.familyname;})
          		.attr("href", function(d) { return "http://mostapharoudsari.github.io/teaching?who=" + d.id + "&where=" + school + "&when=" + semester + "&what=" + course; })
            .style("background-image", function(d) { return "url(" + background + ")";});


        studentsGrid.append("span")
          .attr("class", "description")
          .text(function(d) { return d.name.replace(/-/g, " ") + " " + d.familyname.replace(/-/g, " "); });
	});


	function load_assignments(){
		
		reset_page();
		
		d3.select("h2#project-name").text("Pick One of the assignments!")
		
		//update assignment list based on student name
		var studentId = d3.select(this).property("value");
		var student = students.filter(function(s){return s.id == studentId;})[0];
		
		// add select object and list of assignments
		// remove if there is any selector already for another student
		d3.select("select#project-name").remove();

		// add selector for students
		var assignmentSelect = d3.select("div#selectors")
			.append("select")
			.attr("id", "project-name");
		
		assignmentSelect.selectAll("option")
              .data(d3.keys(student['assignments']))
              .enter()
                .append("option")
                .attr("value", function(d){ return d; })
                .text(function(d){ return d; });
		
		assignmentSelect.append("option")
            .text("Assignments...")
			.attr("selected", "selected")
			.attr("disabled", "disabled");
		
		assignmentSelect.on("change", load_assignment);

		
		d3.select("#grid").selectAll("a").remove();

		// create grid
		var assignmentsGrid = d3.select("#grid").selectAll(".grid")
          	.data(d3.keys(student['assignments']))
        	.enter().insert("a", "br")
          		.attr("class", "grid")
          		.attr("title", function(d) {return d;})
          		.attr("href", function(d) { return "http://mostapharoudsari.github.io/teaching?who=" + studentId + "&where=" + school + "&when=" + semester + "&what=" + course + "&assignment=" + d; })
            .style("background-image", function(d) { return "url(" + background1 + ")";});


        assignmentsGrid.append("span")
          .attr("class", "description")
          .text(function(d) { return d; });

	}


	function load_assignment(){
		// find the student
		var studentId = d3.select("select#student-name").property("value");
		var student = students.filter(function(s){return s.id == studentId;})[0];

		// find the assignment
		var assignment = d3.select(this).property("value");

		// update page
		update_page(student, assignment);
	}

	function reset_page(){

		// remove all the current objects from the page
		d3.select("h1#student-name").selectAll("a").remove();
		d3.select("h2#project-name").selectAll("text").remove();
		d3.select("div#downloads").selectAll("span").remove();
		d3.select("div#viewer").selectAll("object").remove();

		//hide the footer
		d3.select("footer").style("display", 'none');
	}

	function get_icon_name(filename){

		return "../lib/icons/" + filename.split(".")[filename.split(".").length-1].toLowerCase() + ".ico";
	}

	function update_page(student, assignment){	
		
		reset_page();
		
		var studentInfo = {
				name: student.name + " " + student.familyname,
				email: student.email
			},
			project_name = assignment,
			filenames = student.assignments[assignment];

			pdffiles = filenames.filter(function(f){return f.toLowerCase().endsWith('.pdf')});

		var studentFolder = baseLocation + "/students/" + student.familyname + "_" + student.name + "/" + project_name;

		// update name
		d3.select("h1#student-name")
			.selectAll("a").data([studentInfo])
			.enter()
			.append("a")
				.attr("target", "blank")
				.attr("href", function(d){return "mailto:" + d.email + "?Subject=ARCH753%20Project";})
				.text(function(d){return d.name;});

		// update project name
		d3.select("h2#project-name").text(project_name);

		// update file list
		var files = d3.select("div#downloads")
			.selectAll("span").data(filenames)
			.enter()
			.append("span")
			.attr("class", "files")
			.attr("title", "Click to download the file.")
			.on("click", function(d){ window.location = studentFolder + "/" + d;});

		// append icons
		files.append("img")
			.attr("class", "filename")
			.attr("src", function(d){return get_icon_name(d);});

		// append file names
		files.append("span")
			.attr("class", "filename")
			.text(function(d){return d;});

		// update link for pdf file
		d3.select("div#viewer")
			.selectAll("object")
			.data(pdffiles).enter()
			.append("object")
				.attr("id", "viewer")
				.attr("data", function(d){return studentFolder + "/" + d;})
				.attr("type", "application/pdf")
				.append("param")
					.attr("name", "zoom")
					.attr("value", "scale"); //Set initial zoom. Won't work in Chrome

		// unhide the footer
		d3.select("footer").style("display", 'block');
	}

</script>